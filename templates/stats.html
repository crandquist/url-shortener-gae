{% extends "base.html" %}

{% block title %}URL Statistics{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h1 class="h4 mb-0">URL Statistics</h1>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5>Short URL:</h5>
                        <div class="input-group">
                            <input type="text" class="form-control" value="{{ request.host_url }}{{ short_code }}" id="shortenedUrl" readonly>
                            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()">Copy</button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Original URL:</h5>
                        <a href="{{ long_url }}" target="_blank" class="text-truncate d-inline-block w-100">{{ long_url }}</a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h3 class="display-4">{{ visit_count }}</h3>
                                <p class="lead">Total Clicks</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h4>{{ created.strftime('%Y-%m-%d %H:%M') }}</h4>
                                <p class="lead">Created On</p>
                            </div>
                        </div>
                    </div>
                </div>

                {% if visits %}
                <h4 class="mt-4">Recent Visits</h4>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>User Agent</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for visit in visits %}
                            <tr>
                                <td>{{ visit.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                                <td class="text-truncate" style="max-width: 300px;">{{ visit.user_agent }}</td>
                                <td>{{ visit.ip }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info mt-4">
                    No visits recorded yet.
                </div>
                {% endif %}

                <div class="mt-3">
                    <a href="/" class="btn btn-primary">Back to Home</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    var copyText = document.getElementById("shortenedUrl");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    document.execCommand("copy");
    alert("Copied the URL: " + copyText.value);
}
</script>
{% endblock %}